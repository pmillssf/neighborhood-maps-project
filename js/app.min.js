function initMap(){var e=setTimeout(function(){alert("Uh oh, Google Maps has failed to load!")},4e3),t=[{featureType:"all",elementType:"all",stylers:[{invert_lightness:!0},{saturation:10},{lightness:30},{gamma:.5},{hue:"#435158"}]},{featureType:"administrative",elementType:"labels.text.stroke",stylers:[{color:"#ffffff"},{weight:6}]},{featureType:"administrative",elementType:"labels.text.fill",stylers:[{color:"#435158"}]}];map=new google.maps.Map(document.getElementById("map"),{center:{lat:37.7636505,lng:-122.4556266},zoom:13,styles:t}),clearTimeout(e),ko.applyBindings(new MapViewModel)}function MapViewModel(){for(var e=this,t=new google.maps.InfoWindow,i=new google.maps.LatLngBounds,o=0;o<locations().length;o++){var a=locations()[o].location,n=locations()[o].title;marker=new google.maps.Marker({map:map,position:a,title:n,icon:locations()[o].icon,animation:google.maps.Animation.DROP,id:o}),markers.push(marker),visibleMarkers.push(marker),marker.addListener("click",function(){populateInfoWindow(this,t)}),i.extend(markers()[o].position)}map.fitBounds(i),google.maps.event.addDomListener(window,"resize",function(){map.fitBounds(i),map.setCenter({lat:37.7636505,lng:-122.4556266})}),e.filteredListItems=ko.computed(function(){var e=new google.maps.LatLngBounds,t=query().toLowerCase();if(t)return ko.utils.arrayFilter(visibleMarkers(),function(i){var o=i.title.toLowerCase(),a=-1!=o.indexOf(t);return a===!0?(i.setVisible(!0),e.extend(i.position),map.fitBounds(e)):i.setVisible(!1),a});for(o=0;5>o;o++)visibleMarkers()[o].setVisible(!0);return visibleMarkers()})}function populateInfoWindow(e,t){if(map.setCenter(e.position),t.marker!=e){t.marker=e,titleHtml="<h4>"+e.title+"</h4>",wikiFail="<div>Wikipedia has failed to load</div>";var i="https://en.wikipedia.org/w/api.php?action=opensearch&search="+e.title+"&format=json&callback=wikiCallback",o=setTimeout(function(){t.setContent(titleHtml+wikiFail)},4e3);$.ajax({url:i,dataType:"jsonp"}).done(function(i){var a=i[1],n=a[0],r="https://en.wikipedia.org/wiki/"+n,l='<div>Learn more: <a href="'+r+'">'+n+"</a></div>";if(t.setContent(titleHtml+l),clearTimeout(o),"Letterform Archive"===e.title){var s='<div>Letterform Archive has no wiki page, check out their<a href="http://letterformarchive.org/"> website.</a></div>';t.setContent(titleHtml+s)}}),t.setContent("<div>"+e.title+"</div>"),t.open(map,e),t.addListener("closeclick",function(){t.marker=null})}null===e.getAnimation()&&(e.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){e.setAnimation(null)},1400))}function googleError(){alert("Uh oh, Google Maps API has failed to load!")}var locations=ko.observableArray([{title:"San Francisco Mechanics Institute",location:{lat:37.788862,lng:-122.402976},icon:"images/2915103_1.png"},{title:"San Francisco Center for the Book",location:{lat:37.765357,lng:-122.402344},icon:"images/book.png"},{title:"Letterform Archive",location:{lat:37.763783,lng:-122.394046},icon:"images/schreibwaren_web.png"},{title:"San Francisco Model Yacht Club",location:{lat:37.771221,lng:-122.494308},icon:"images/sailing.png"},{title:"Book Club of California",location:{lat:37.789842,lng:-122.405878},icon:"images/library.png"}]),markers=ko.observableArray([]),visibleMarkers=ko.observableArray([]),selectedMarker=ko.observable(),map,marker,showSelected=ko.computed(function(){if(5===markers().length&&"object"==typeof selectedMarker()){for(i=0;i<5;i++)markers()[i].setVisible(!1);selectedMarker().setVisible(!0),map.setCenter(selectedMarker().position),null===selectedMarker().getAnimation()&&(selectedMarker().setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){selectedMarker().setAnimation(null)},1400)),populateInfoWindow(selectedMarker(),new google.maps.InfoWindow)}}),query=ko.observable("");

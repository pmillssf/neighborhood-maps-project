function initMap(){var e=setTimeout(function(){alert("Uh oh, Google Maps has failed to load!")},4e3),o=[{featureType:"all",elementType:"all",stylers:[{invert_lightness:!0},{saturation:10},{lightness:30},{gamma:.5},{hue:"#435158"}]},{featureType:"administrative",elementType:"labels.text.stroke",stylers:[{color:"#ffffff"},{weight:6}]},{featureType:"administrative",elementType:"labels.text.fill",stylers:[{color:"#435158"}]}];map=new google.maps.Map(document.getElementById("map"),{center:{lat:37.7636505,lng:-122.4556266},zoom:13,styles:o}),clearTimeout(e),ko.applyBindings(new MapViewModel);for(var t=0;t<closeInfoWindows.length;t++)closeInfoWindows[t].close()}function MapViewModel(){for(var e=this,o=new google.maps.InfoWindow,t=new google.maps.LatLngBounds,i=0;i<locations().length;i++){var n=locations()[i].location,a=locations()[i].title;marker=new google.maps.Marker({map:map,position:n,title:a,icon:locations()[i].icon,animation:google.maps.Animation.DROP,id:i}),markers.push(marker),visibleMarkers.push(marker),marker.addListener("click",function(){populateInfoWindow(this,o)}),t.extend(markers()[i].position)}map.fitBounds(t),google.maps.event.addDomListener(window,"resize",function(){map.fitBounds(t),map.setCenter({lat:37.7636505,lng:-122.4556266})}),e.filteredListItems=ko.computed(function(){var e=new google.maps.LatLngBounds,o=query().toLowerCase();if(o)return ko.utils.arrayFilter(visibleMarkers(),function(t){var i=t.title.toLowerCase(),n=-1!=i.indexOf(o);return n===!0?(t.setVisible(!0),e.extend(t.position),map.fitBounds(e)):t.setVisible(!1),n});for(i=0;5>i;i++)visibleMarkers()[i].setVisible(!0);return visibleMarkers()})}function populateInfoWindow(e,o){if(map.setCenter(e.position),o.marker!=e){o.marker=e;var t="<h4>"+e.title+"</h4>",i="<div>Wikipedia has failed to load</div>",n="https://en.wikipedia.org/w/api.php?action=opensearch&search="+e.title+"&format=json&callback=wikiCallback",a=setTimeout(function(){o.setContent(t+i)},4e3);$.ajax({url:n,dataType:"jsonp"}).done(function(i){var n=i[1],r=n[0],l="https://en.wikipedia.org/wiki/"+r,s='<div>Learn more: <a href="'+l+'">'+r+"</a></div>";if(o.setContent(t+s),clearTimeout(a),"Letterform Archive"===e.title){var c='<div>Letterform Archive has no wiki page, check out their<a href="http://letterformarchive.org/"> website.</a></div>';o.setContent(t+c)}}),o.setContent("<div>"+e.title+"</div>"),o.open(map,e),o.addListener("closeclick",function(){o.marker=null}),closeInfoWindows.push(o)}null===e.getAnimation()&&(e.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){e.setAnimation(null)},1400))}function liClicked(e){populateInfoWindow(e,new google.maps.InfoWindow)}function googleError(){alert("Uh oh, Google Maps API has failed to load!")}var locations=ko.observableArray([{title:"San Francisco Mechanics Institute",location:{lat:37.788862,lng:-122.402976},icon:"images/2915103_1.png"},{title:"San Francisco Center for the Book",location:{lat:37.765357,lng:-122.402344},icon:"images/book.png"},{title:"Letterform Archive",location:{lat:37.763783,lng:-122.394046},icon:"images/schreibwaren_web.png"},{title:"San Francisco Model Yacht Club",location:{lat:37.771221,lng:-122.494308},icon:"images/sailing.png"},{title:"Book Club of California",location:{lat:37.789842,lng:-122.405878},icon:"images/library.png"}]),markers=ko.observableArray([]),visibleMarkers=ko.observableArray([]),selectedMarker=ko.observable(),map,marker,clickLi,closeInfoWindows=[],showSelected=ko.computed(function(){if(5===markers().length&&"object"==typeof selectedMarker()){for(i=0;i<5;i++)markers()[i].setVisible(!1);selectedMarker().setVisible(!0),map.setCenter(selectedMarker().position),null===selectedMarker().getAnimation()&&(selectedMarker().setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){selectedMarker().setAnimation(null)},1400)),populateInfoWindow(selectedMarker(),new google.maps.InfoWindow)}}),query=ko.observable("");
